<header class="top-menu">
  <nav class="menu-items" aria-label="Categor√≠as">
    <button
      type="button"
      (click)="onSelect('inicio')"
      [class.is-active]="activeCategory === 'inicio'">
      Inicio
    </button>

    <button
      type="button"
      (click)="onSelect('politica')"
      [class.is-active]="activeCategory === 'politica'">
      Pol√≠tica
    </button>

    <button
      type="button"
      (click)="onSelect('economia')"
      [class.is-active]="activeCategory === 'economia'">
      Econom√≠a
    </button>

    <button
      type="button"
      (click)="onSelect('seguridad')"
      [class.is-active]="activeCategory === 'seguridad'">
      Seguridad
    </button>

    <button
      type="button"
      (click)="onSelect('deportes')"
      [class.is-active]="activeCategory === 'deportes'">
      Deportes
    </button>

    <button
      type="button"
      (click)="onSelect('salud')"
      [class.is-active]="activeCategory === 'salud'">
      Salud
    </button>

    <button
      type="button"
      (click)="onSelect('sociedad')"
      [class.is-active]="activeCategory === 'sociedad'">
      Sociedad
    </button>

    <button
      type="button"
      (click)="onSelect('educacion')"
      [class.is-active]="activeCategory === 'educacion'">
      Educaci√≥n
    </button>

    <button
      type="button"
      (click)="onSelect('gestion')"
      [class.is-active]="activeCategory === 'gestion'">
      Gestiones P√∫blicas
    </button>
    <button
      type="button"
      (click)="onSelect('ambiente')"
      [class.is-active]="activeCategory === 'ambiente'">
      Medio Ambiente
    </button>

    <button
      type="button"
      (click)="onSelect('otros')"
      [class.is-active]="activeCategory === 'otros'">
      Otros
    </button>

    <button
      type="button"
      (click)="onSelect('entidades')"
      [class.is-active]="activeCategory === 'entidades'">
      Entidades P√∫blicas
    </button>

    <button
      type="button"
      (click)="onSelect('personas')"
      [class.is-active]="activeCategory === 'personas'">
      Personas P√∫blicas
    </button>
  </nav>
</header>

<div class="page">
  <!-- Filtros -->
  <section class="filters-section">
    <div class="filters-header">
      <h3>
        <mat-icon>tune</mat-icon>
        Filtros
      </h3>

      <span class="page-indicator">Categor√≠a: {{ activeCategory }}</span>
    </div>

    <div class="filters-row">
      <mat-form-field appearance="outline" class="filter-item">
        <mat-label>Rango de fechas</mat-label>
        <mat-date-range-input [rangePicker]="picker">
          <input matStartDate placeholder="Inicio" [(ngModel)]="startDate" />
          <input matEndDate placeholder="Fin" [(ngModel)]="endDate" />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-item">
        <mat-label>Seleccionar usuarios</mat-label>
        <mat-select [(ngModel)]="selectedUsers" multiple>
          <mat-option *ngFor="let user of users" [value]="user.idTweetUser">
            {{ user.TweetUser }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-item">
        <mat-label>Buscar</mat-label>
        <input matInput [(ngModel)]="searchText" placeholder="Texto de b√∫squeda" />
      </mat-form-field>

      <div class="filter-buttons">
        <button mat-flat-button color="primary" class="filter-btn" (click)="filtrar()">
          <mat-icon>search</mat-icon>
          Filtrar
        </button>

        <button mat-stroked-button class="filter-btn" (click)="limpiar()">
          <mat-icon>refresh</mat-icon>
          Limpiar
        </button>
      </div>
    </div>
  </section>

  <!-- Estado -->
  <div *ngIf="cargando" class="state">‚è≥ Cargando noticias...</div>
  <div *ngIf="error" class="state state-error">{{ error }}</div>

  <!-- Lista -->
  <section *ngIf="!cargando && datos.length" class="news-container">
    <article *ngFor="let item of datos" class="news-item">

      <div class="news-header">
        <div class="news-title">{{ item.TweetUser }}</div>

        <!-- ‚úÖ Pills derecha: sentimiento + categor√≠a -->
        <div class="chips-right">
          <span
            class="status-chip"
            [ngClass]="{
              negativo: item.sentimiento === 'negativo',
              neutral: item.sentimiento === 'neutro',
              positivo: item.sentimiento === 'positivo'
            }"
          >
            {{ item.sentimiento }}
          </span>

          <!-- ‚úÖ NUEVO: pill de categor√≠a -->
          <span class="category-chip">
            {{ item.categoria }}
          </span>
        </div>
      </div>

      <p class="news-text">{{ item.text }}</p>

      <div class="news-meta">
        <span class="news-date">{{ item.created | date: 'mediumDate' }}</span>

        <div class="sentiment-icons">
          <span class="icon">üò° <b>0</b></span>
          <span class="icon">üòê <b>0</b></span>
          <span class="icon">üòä <b>0</b></span>
        </div>
      </div>

      <!-- Acciones por categor√≠a -->
      <div class="news-actions">
        <button type="button" (click)="accion(item.tweetid, 'Politica', item.categoria)">Pol√≠tica</button>
        <button type="button" (click)="accion(item.tweetid, 'Economia', item.categoria)">Econom√≠a</button>
        <button type="button" (click)="accion(item.tweetid, 'Seguridad', item.categoria)">Seguridad</button>
        <button type="button" (click)="accion(item.tweetid, 'Deportes', item.categoria)">Deportes</button>
        <button type="button" (click)="accion(item.tweetid, 'Salud', item.categoria)">Salud</button>
        <button type="button" (click)="accion(item.tweetid, 'Sociedad', item.categoria)">Sociedad</button>
        <button type="button" (click)="accion(item.tweetid, 'Educacion', item.categoria)">Educaci√≥n</button>
        <button type="button" (click)="accion(item.tweetid, 'Ambiente', item.categoria)">Medio Ambiente</button>
        <button type="button" (click)="accion(item.tweetid, 'Gestion', item.categoria)">Gesti√≥n</button>
        <button type="button" (click)="accion(item.tweetid, 'Otros', item.categoria)">Otros</button>
      </div>

      <!-- ‚úÖ NUEVO: acciones por sentimiento -->
      <div class="sentiment-actions">
        <button type="button" class="sbtn pos" (click)="accionsentiment(item.tweetid, 'Positivo', item.sentimiento)">Positivo</button>
        <button type="button" class="sbtn neu" (click)="accionsentiment(item.tweetid, 'Neutro', item.sentimiento)">Neutro</button>
        <button type="button" class="sbtn neg" (click)="accionsentiment(item.tweetid, 'Negativo', item.sentimiento)">Negativo</button>
      </div>

    </article>
  </section>

  <!-- Paginaci√≥n -->
  <div class="pagination" *ngIf="!cargando && datos.length">
    <button
      mat-flat-button
      color="primary"
      class="pagination-btn prev"
      (click)="loadPreviousPage()"
      [disabled]="currentPage === 1"
    >
      <mat-icon>arrow_back_ios_new</mat-icon>
      Anterior
    </button>

    <span class="page-indicator">P√°gina {{ currentPage }}</span>

    <button
      mat-flat-button
      color="primary"
      class="pagination-btn next"
      (click)="loadNextPage()"
      [disabled]="!hasMore"
    >
      Siguiente
      <mat-icon>arrow_forward_ios</mat-icon>
    </button>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!cargando && !datos.length && !error" class="state">
    No hay noticias disponibles para los filtros seleccionados.
  </div>
</div>
